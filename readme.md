Репозиторий по 13 кейсу ЛЦТ2023

Ветка для бэкенда



# /all_flight все рейсы


# /seasonality данные для графика сезонности
данные берутся из таблицы flightdata по номеру рейса и возвращаются данные из столбцов dd, tt и demcluster, а также добавляются данные из столбоцов с буквами


# /booking данные для графика резервирования
данные берутся из таблиц reserv_aer_svo, ***asf-svo, ***svo-aer или ***svo-asf
При построении графиков динамики резервирования я отбираю те столбцы, где все значения за период резервирования нулевые (сумма всех значений меньше 1) и игнорирую их. Для построения графиков используются только столбцы с ненулевыми значениями хотя бы в одной строке.

Перед этим данные отбираются по номеру рейса и дате вылета. В результате остается максимум 270 строк, обычно 217 строк. Но все столбцы тоже не нужны, нужно оставить только ненулевые.


# /booking_point данные для верхнего графика резервирования с уетом сезонов


# /booking_point_second данные для второго графика резервирования с учетом сезонов

Сначала получаем hot_cold_cluster. Из таблицы reserv*** получаем только уникальные значения hcbuy, которые соответствуют номеру рейса (flt_num) и дате вылета (dd). Затем берем две колонки dtd и tt  из таблицы reserv***, которые соответствуют номеру рейса (flt_num) и дате вылета (dd). По колонке dtd получаем 0.25 и 0.75 персентиль.Далее возвращаем значения этих персентилей

sdf = pd.read_sql(f"SELECT * FROM reserv WHERE flt_num='{fltnum}' AND dd='{date_str}' ", reserv_conn) #, parse_dates=['dd'])
nonzero_segments = [s for s in segment_names if sdf[s].gt(0).any()] 

# / данные для профиля спроса


# /demand_forecast 4 вкладка - данные для прогноза спроса


# / 4 вкладка - данные для прогноза резервирования по классам(сегментам) бронирования